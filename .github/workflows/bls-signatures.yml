name: Build and Test

on: [push, pull_request]

jobs:

  job:
    name: BLS Library
    runs-on: ubuntu-latest
    steps:

    - name: Check out repo
      uses: actions/checkout@v2

    - name: Build src
      run: |
        mkdir build
        cd build
        cmake ..
        make
    - name: Test src
      run: |
        ./build/src/runtest

    - name: Install Go
      uses: actions/setup-go@v2
      with:
        go-version: ^1.13

    - name: Setup Go environment
      run: |
        mkdir -p go/src/github.com/dashpay
        ln -s $(pwd) $(pwd)/go/src/github.com/dashpay/bls-signatures
        go get -v -t -d ./...
      env:
        GOPATH: /home/runner/work/bls-signatures/bls-signatures/go

    - name: Build go-bindings
      run: |
        cd go/src/github.com/dashpay/bls-signatures/go-bindings
        go build -v .
      env:
        GOPATH: /home/runner/work/bls-signatures/bls-signatures/go

    - name: Test go-bindings
      run: |
        cd go/src/github.com/dashpay/bls-signatures/go-bindings
        go test -v .
      env:
        GOPATH: /home/runner/work/bls-signatures/bls-signatures/go
